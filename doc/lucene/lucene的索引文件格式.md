# 一、Lucene的索引层次结构
- 索引（index）  
   - 在lucene中一个索引是放在一个文件夹中的；  
   - 同一个文件夹中的所有文件构成一个lucene索引；  
- 段（segment）
   - 一个索引可以包含多个段，段与段之间是独立的，添加新文档可以生成新的段，不同的段可以合并；  
   - 具有相同前缀的文件属于同一个段；
   - segments.gen和segments_N是段的元数据文件，它们保存了段的属性信息；
- 文档（Document）
   - 文档是我们建索引的基本单位，不同的文档是保存在不同的段中的，一个段可以包含多篇文档；  
   - 新添加的文档是单独保存在一个新生成的段中的，随着段的合并，不同的文档合并到不同的段中；  
- 域（field）
   - 一篇文档包含不同类型的信息，可以分开索引，比如标题、时间、正文、作者等都可以保存在不同的域里；  
   - 不同域的索引方式可以不同；
- 词（Term）
   - 词是索引的最小单位，是经过词法分析和语言处理后的字符串；  
- 正向信息
   - lucene的索引结构中，保存了从索引一直到词的包含关系：索引（index） -> 段（segment） -> 文档（document） -> 域（field） -> 词（term）
   - 包含正向信息的文件有：  
      - segments_N保存了此索引包含多少个段，每个段包含多少篇文档；  
      - XXX.fdx、XXX.fdt保存了此段包含的所有文档，每篇文档包含了多少域，每个域保存了哪些信息；
      - XXX.fnm保存了此段包含了多少个域，每个域的名称及索引方式；
      - XXX.tvx、XXX.tvd、XXX.tvf保存了此段包含多少文档，每篇文档包含了多少域，每个域包含了多少次，每个词的字符串、位置等信息；
- 反向信息  
   -  lucene的索引结构中，保存了词典到倒排表的映射：词（Term） -> 文档（Document）
   - 包含反向信息的文件有：
      - XXX.tis、XXX.tii保存了词典，也即此段包含的所有的词按字典顺序的排序；  
      - XXX.frq：保存了倒排表，也即包含每个词的文档ID列表；
      - XXX.prx保存了倒排表中的每个词在包含此词的文档中位置；  
  
# 二、lucene的基本类型
- byte：最基本的类型，长8bit;  
- uint32：4个byte组成；  
- uint64：8个byte组成；  
- vint：变长的整数类型，包含多个byte，对于每个byte的8位，后7位表示数值，最高1位表示是否还有另一个byte；  
- chars：utf-8编码的一系列byte；  
- string：一个字符串首先是一个vint表示的表示此字符串包含的字符的格式，接着便是utf-8编码的字符序列chars；  

# 三、基本原则
1. 前缀后缀原则（Prefix+Suffix）
   Lucene在反向索引中，要保存词典的信息，所有的词在词典中是按照字典顺序进行排列的，然而词典中包含了此文档中的几乎所有词，并且有的词还是非常的长的，这样索引文件会非常的大。  
   所谓前缀后缀原则，即当某个词
   
   
索引文件格式总体结构如下：
![blockchain](https://images2018.cnblogs.com/blog/1426944/201807/1426944-20180706203500917-149193956.png "Lucene索引文件格式总体结构")




