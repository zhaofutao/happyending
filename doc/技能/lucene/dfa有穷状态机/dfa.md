# 一、确定型有穷自动机（Deterministic Finite Automaton）
        有穷自动机分为确定型有穷自动机（DFA）和不确定型有穷自动机（NFA）。
        确定型有穷状态机在读任何输入序列后只能出在一个状态中，术语“确定型”是指这样的事实：在每个输入上存在且仅存在一个状态，自动机可以从当前状态转义到这个状态。
# 二、确定型有穷自动机的定义
        一个确定型有穷自动机包括：
  - 一个有穷的状态集合，通常记做Q；
  - 一个有穷的输入符号集合，通常记错Σ；
  - 一个转移函数，以一个状态和一个输入符号作为变量，返回一个状态。转义函数通常记做δ。在表示自动机的图中，用状态之间的箭弧和箭弧上的标记来表示δ,如果q是一个状态，a是一个输入符号，则δ(q, a)是这样的状态p,使得从p到q有带a标记的箭弧。
  - 一个初始状态，是Q中状态之一。
  - 一个终结状态或接受状态的集合F，集合F是Q的子集。  

        通常用多谢DFA来表示确定型有穷自动机，最紧凑的DFA表示是列出上面5个部分，DFA可以用上面的五元组表示：A = (Q, Σ, δ, q0, F)，其中A是DFA的名称，Q是状态集合，Σ是输入符号，δ是转移函数，q0是初始状态，F是接受状态集合。
# 三、DFA怎么处理串
        假设a1a2...an是输入序列。
        让这个DFA从初始状态q0开始运行，查询转义函数δ，比如说δ(q0, a1) = q1, 以找出DFA在处理第一个输入符号a1之后进入的状态。
        处理下一个输入符号a2，求δ（q1, a2)的值，假设这个状态是q2。
        以这种方式继续下去，找出状态q3、q4、...qn,使得对每个i,δ(qi-1, ai) = qi。
        如果qn属于F，则接受输入a1a2...an，否则就拒绝。
# 四、DFA在Lucene中的应用
        在Lucene中，跟DFA相关功能有通配符查询（WildcardQuery）、正则表达式（RegexpQuery）、范围查询（TermRangeQuery）等。

# 五、Lucene如何描述DFA
        Lucene通过两个int类型的数组transitions、states描述转移函数。
  - transitions数组：  
        数组中使用固定的连续的三个数组元素来描述一个转移函数的三个信息；
    - 目标状态dest：描述当前状态转义到下一个状态，即目标状态
    - 输入符号的最小值min：描述当前转移可接受的最小输入符号；
    - 输入符号的最大值max：描述当前转移可接受的最大输入符号；
  - states数组:  
        数组中使用固定的了连续的两个数组元素来描述当前状态的两个信息
    - 当前状态的第一个转移函数信息在transitions数组中的起始位置；
    - 当前状态的转移函数的数量；

![image](/resource/images/lucene中dfa描述.png)   

        状态0的状态值为0，即curState = 0，根据公式2 * curState跟2 * curState + 1分别获得states[]数组的两个下标值，这两个下标值对应的数组元素分别描述了状态0的第一个转移函数信息在transitions数组中的起始位置，以及状态0的转移函数的数量，由于transitions数组中用固定数量的数组元素描述一个转移函数的信息，故length的值为3 * 3 = 9;
        对于状态0的第一个转移函数，desc藐视了转移到下一个状态的状态值，即状态2，并且接收最小值min为98，最大值为98的输入符号，也就是说状态0到状态2的转移只接受字符b。

# 六、TermRangeQuery构建DFA的流程图

![image](/resource/images/dfa构建流程图.png)  

## 6.1 构建sinkState、startState的转移函数
        sinkState为可接受状态，由于我们处理的term是ASCII码，所以该状态可接受的输入符号为0~255，即所有的ASCII码。
        startState为初始化状态，由于查询条件的上下界minValue、maxValue分别为"bc"、"gch"，根据这两个值的第一个字符"b"、"g"，我们需要创建三个转移函数。
  - 只接受"b"的输入字符；
  - 接收"c"~"f"范围的输入字符；（下一个转移为自己本身，并且min和max分别为0,255，随后的所有符号都被接受，为可接受状态）
  - 只接受"g"的输入字符；
## 6.2 根据minValue构建状态跟转移函数
        minValue只剩下"c"待处理，此时需要构建两个转移函数：
  - 只接受"c"的输入字符；
  - 接受"d"~255的输入字符；
        这两个转移函数的下一个状态与6.1中相同，可以合并。
## 6.3 根据maxValue构建状态跟转移方程
        maxValue只剩下"ch"需要处理，逻辑与minValue基本相同。